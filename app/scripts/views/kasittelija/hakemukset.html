<div class="container">
  <div ng-hide="sallittu('view-kaikki-hakemukset')">
    <p>Ei kaikkien hakemusten katseluoikeutta.</p>
  </div>
  <div ng-show="hakemukset.length==0">
    <p>Ei hakemuksia, koska hakemuskautta ei ole vielä avattu.</p>
  </div>

  <div ng-show="hakemukset.length> 0 && sallittu('view-kaikki-hakemukset')">
    <juku-navigation>
      <juku-tabs>
        <juku-tab ui-sref="app.yhteinen.hakemukset.list({tyyppi: 'AH0'})">
          Avustushakemukset
          <juku-badge
            number="kasiteltavatAvustushakemukset"
            ng-show="sallittu('kasittely-hakemus') || sallittu('hyvaksy-paatos')" />
        </juku-tab>

        <juku-tab ui-sref="app.yhteinen.hakemukset.list({tyyppi: 'MH1'})">
          1. maksatushakemukset
          <juku-badge
            number="kasiteltavatMaksatus1hakemukset"
            ng-show="sallittu('kasittely-hakemus') || sallittu('hyvaksy-paatos')" />
        </juku-tab>
        <juku-tab ui-sref="app.yhteinen.hakemukset.list({tyyppi: 'MH2'})">
          2. maksatushakemukset
          <juku-badge
            number="kasiteltavatMaksatus2hakemukset"
            ng-show="sallittu('kasittely-hakemus') || sallittu('hyvaksy-paatos')" />
        </juku-tab>
      </juku-tab>
    </juku-navigation>

    <accordion close-others="false">
      <div ng-repeat="hakemuksetPerVuosi in hakemukset">
        <accordion-group is-open="hakemuksetPerVuosi.accordionOpen">
          <accordion-heading>
            <h4>
              <i class="pull-left glyphicon"
                 ng-class="{
                  'glyphicon-chevron-down': hakemuksetPerVuosi.accordionOpen,
                  'glyphicon-chevron-right': !hakemuksetPerVuosi.accordionOpen
                  }"></i>
              <span ng-show="tyyppi === 'AH0'">
                JOUKKOLIIKENTEEN AVUSTUSHAKEMUKSET {{hakemuksetPerVuosi.vuosi}}
              </span>
              <span ng-show="tyyppi === 'MH1'">
                JOUKKOLIIKENTEEN MAKSATUSHAKEMUKSET AJALTA 1.1-30.6.{{hakemuksetPerVuosi.vuosi}}
              </span>
              <span ng-show="tyyppi === 'MH2'">
                JOUKKOLIIKENTEEN MAKSATUSHAKEMUKSET AJALTA 1.7-31.12.{{hakemuksetPerVuosi.vuosi}}
              </span>
            </h4>
          </accordion-heading>
          <div class="row">

            <h4>Suuret kaupunkiseudut</h4>

            <div class="row">
              <div class="col-md-12">
                <table st-table="ks1displayed" class="table table-hover"
                       st-safe-src=hakemuksetPerVuosi.ks1HakemuksetPerVuosi>
                  <thead>
                  <tr>
                    <th st-sort="hakija">Hakija</th>
                    <th st-sort="hakemuksenTila">Hakemuksen tila</th>
                    <th st-sort="viimeisinMuutos">Viimeisin muutos</th>
                    <th st-sort="diaarinumero">Diaarinumero</th>
                    <th st-sort="kasittelija">Käsittelijä</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr ng-repeat="hakemus in ks1displayed"
                      ui-sref="app.kasittelija.hakemukset.hakemus({
                        vuosi: hakemuksetPerVuosi.vuosi,
                        id: hakemus.avustushakemusId,
                        m1id: hakemus.maksatushakemus1Id,
                        m2id: hakemus.maksatushakemus2Id,
                        tyyppi: tyyppi
                      })">
                    <td>{{hakemus.hakija}}</td>
                    <td>
                      <hakemus-label tila="{{hakemus.hakemuksenTila}}"></hakemus-label>
                    </td>
                    <td>{{hakemus.viimeisinMuutos | date:'dd.MM.yyyy HH:mm:ss'}}</td>
                    <td>{{hakemus.diaarinumero}}</td>
                    <td>{{hakemus.kasittelija}}</td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="row">
              <div class="col-md-8"></div>
              <div class="col-md-4">
                <div class="pull-right">

                  <juku-link-next
                     ng-show="sallittu('kasittely-hakemus')"
                     ui-sref="app.kasittelija.suunnittelu({
                      vuosi: hakemuksetPerVuosi.vuosi,
                      tyyppi: tyyppi,
                      lajitunnus: 'KS1'
                    })">
                    Suunnittelu ja päätöksenteko
                  </juku-link-next>

                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <h4>Keskisuuret kaupunkiseudut</h4>

            <div class="row">
              <div class="col-md-12">
                <table st-table="ks2displayed" class="table table-hover table-condensed"
                       st-safe-src=hakemuksetPerVuosi.ks2HakemuksetPerVuosi>
                  <thead>
                  <tr>
                    <th st-sort="hakija">Hakija</th>
                    <th st-sort="hakemuksenTila">Hakemuksen tila</th>
                    <th st-sort="viimeisinMuutos">Viimeisin muutos</th>
                    <th st-sort="diaarinumero">Diaarinumero</th>
                    <th st-sort="kasittelija">Käsittelijä</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr ng-repeat="hakemus in ks2displayed"
                      ui-sref="app.kasittelija.hakemukset.hakemus({
                        vuosi: hakemuksetPerVuosi.vuosi,
                        id: hakemus.avustushakemusId,
                        m1id: hakemus.maksatushakemus1Id,
                        m2id: hakemus.maksatushakemus2Id,
                        tyyppi: tyyppi
                      })">
                    <td>{{hakemus.hakija}}</td>
                    <td>
                      <hakemus-label tila="{{hakemus.hakemuksenTila}}"></hakemus-label>
                    </td>
                    <td>{{hakemus.viimeisinMuutos | date:'dd.MM.yyyy HH:mm:ss'}}</td>
                    <td>{{hakemus.diaarinumero}}</td>
                    <td>{{hakemus.kasittelija}}</td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="row">
              <div class="col-md-8"></div>
              <div class="col-md-4">
                <div class="pull-right">
                  <juku-link-next
                    ng-show="sallittu('kasittely-hakemus')"
                    ui-sref="app.kasittelija.suunnittelu({
                      vuosi: hakemuksetPerVuosi.vuosi,
                      tyyppi: tyyppi,
                      lajitunnus: 'KS2'
                    })">
                    Suunnittelu ja päätöksenteko
                  </juku-link-next>
                </div>
              </div>
            </div>
          </div>
          <div class="row">

            <h4>Ely-keskukset</h4>

            <div class="row">
              <div class="col-md-12">
                <table st-table="elydisplayed" class="table table-hover table-condensed"
                       st-safe-src=hakemuksetPerVuosi.elyHakemuksetPerVuosi>
                  <thead>
                  <tr>
                    <th st-sort="hakija">Hakija</th>
                    <th st-sort="hakemuksenTila">Hakemuksen tila</th>
                    <th st-sort="viimeisinMuutos">Viimeisin muutos</th>
                    <th st-sort="diaarinumero">Diaarinumero</th>
                    <th st-sort="kasittelija">Käsittelijä</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr ng-repeat="hakemus in elydisplayed"
                      ui-sref="app.kasittelija.hakemukset.hakemus({
                        vuosi: hakemuksetPerVuosi.vuosi,
                        id: hakemus.avustushakemusId,
                        m1id: hakemus.maksatushakemus1Id,
                        m2id: hakemus.maksatushakemus2Id,
                        tyyppi: tyyppi
                      })">
                    <td>{{hakemus.hakija}}</td>
                    <td>
                      <hakemus-label tila="{{hakemus.hakemuksenTila}}"></hakemus-label>
                    </td>
                    <td>{{hakemus.viimeisinMuutos | date:'dd.MM.yyyy HH:mm:ss'}}</td>
                    <td>{{hakemus.diaarinumero}}</td>
                    <td>{{hakemus.kasittelija}}</td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="row">
              <div class="col-md-8"></div>
              <div class="col-md-4">
                <div class="pull-right">
                  <juku-link-next
                    ng-show="sallittu('kasittely-hakemus')"
                    ui-sref="app.kasittelija.suunnittelu({
                      vuosi: hakemuksetPerVuosi.vuosi,
                      tyyppi: tyyppi,
                      lajitunnus: 'ELY'
                    })">
                    Suunnittelu ja päätöksenteko
                  </juku-link-next>
                </div>
              </div>
            </div>
          </div>
        </accordion-group>
      </div>
    </accordion>
  </div>
</div>
