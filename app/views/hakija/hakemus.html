<div class="container">
  <div ng-hide="sallittu('view-oma-hakemus')">
    <p>Ei omien hakemusten katseluoikeutta.</p>
  </div>
  <div ng-show="sallittu('view-oma-hakemus')">
    <div class="row">
      <div class="col-md-12">
        <a href="#/h/hakemukset"><span class='glyphicon glyphicon-circle-arrow-left'></span>Palaa hakemusten
          päänäkymään</a>
        <a href="#/h/hakemus/{{hakemus.vuosi}}/AH0/{{avustushakemusid}}/{{maksatushakemus1id}}/{{maksatushakemus2id}}"
           class="btn btn-primary">Avustushakemus {{hakemus.vuosi}}</a>
        <a
          href="#/h/maksatushakemus/{{hakemus.vuosi}}/MH1/{{avustushakemusid}}/{{maksatushakemus1id}}/{{maksatushakemus2id}}"
          class="btn btn-default">1. maksatushakemus {{hakemus.vuosi}}</a>
        <a
          href="#/h/maksatushakemus/{{hakemus.vuosi}}/MH2/{{avustushakemusid}}/{{maksatushakemus1id}}/{{maksatushakemus2id}}"
          class="btn btn-default">2. maksatushakemus {{hakemus.vuosi}}</a>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <h2>Joukkoliikenteen valtionavustushakemus {{hakemus.vuosi}}</h2>
      </div>
    </div>
    <div class="row" ng-show="hasPaatos(tyyppi, hakemus.hakemustilatunnus)">
      <div class="col-md-12">
        <p>
          <a href="api/hakemus/{{hakemusid}}/paatos/1/pdf" target="_blank"><span
            class="glyphicon glyphicon-file"></span> Avaa päätös (PDF)</a>
        </p>
      </div>
    </div>

    <form name="hakemusForm">
      <div class="row">
        <div class="col-md-12">
          <h3>VALTIONAVUSTUKSEN KOHDE JA HAETTAVA VALTIONAVUSTUKSEN MÄÄRÄ<a href=""><span
            class='jukutooltip glyphicon glyphicon-question-sign'></span></a></h3>
        </div>
      </div>
      <jku-avustuskohdeluokka luokka="jkuAvustuskohdeluokkaPSA"></jku-avustuskohdeluokka>
      <jku-avustuskohdeluokka luokka="jkuAvustuskohdeluokkaHK"></jku-avustuskohdeluokka>
      <jku-avustuskohdeluokka luokka="jkuAvustuskohdeluokkaK"></jku-avustuskohdeluokka>
      <div class="row">
        <div class="col-md-9">
          <h4>JOUKKOLIIKENTEEN VALTIONAVUSTUSHAKEMUS YHTEENSÄ:</h4>
        </div>
        <div class="col-md-3">
          <div class="pull-right">
            <h4>{{(psa1haettavaavustus + psa2haettavaavustus + psamhaettavaavustus + hkslhaettavaavustus +
              hkklhaettavaavustus + hkllhaettavaavustus +
              hktlhaettavaavustus + kimhaettavaavustus + kmpkhaettavaavustus + kmkhaettavaavustus +
              krthaettavaavustus + kmhaettavaavustus) | currency:"&euro;"}}</h4>
          </div>
        </div>
      </div>
      <div class="form-group">
        <div class="row">
          <div class="col-md-12">
            <label>Lisätietoja avustusten kohteista<a href="" noenter><span
              class='jukutooltip glyphicon glyphicon-question-sign'></span></a></label>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <textarea class="animate msd-elastic: \n;" ng-model="hakemus.selite"></textarea>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h2 class="panel-title">Liitetiedostot</h2>
            </div>
            <div class="panel-body">
              <div class="col-md-8">
                <div ng-show="liitteet.length > 0" class="response">
                  <div class="sel-file" ng-repeat="l in liitteet">
                    <div ng-show="(hakemus.hakemustilatunnus == 'K' || hakemus.hakemustilatunnus == 'T0')">
                      <div ng-show="l.liitenumero!=editoitavaLiite">
                        <p>
                          <a href="api/hakemus/{{hakemusid}}/liite/{{l.liitenumero}}" target="_blank"><span
                            class="glyphicon glyphicon-file"></span>{{l.nimi}}
                            ({{l.contenttype}})</a>
                          <a ng-show="sallittu('modify-oma-hakemus')" href="" title="Muuta liitenimi"
                             ng-click="asetaEditTilaan(l.liitenumero)"><span
                            class='glyphicon glyphicon-pencil'></span></a>
                          <a ng-show="sallittu('modify-oma-hakemus')" href="" title="Poista liite"
                             ng-click="poistaLiite(l.liitenumero)"><span
                            class='glyphicon glyphicon-remove-sign'></span></a>
                        </p>
                      </div>
                      <div ng-show="(l.liitenumero==editoitavaLiite)">
                        <p><span class="glyphicon glyphicon-file"></span>
                          <input name="liitenimi" type="text" class="input-small" noenter
                                 ng-model="l.nimi"
                                 ng-focus="asetaLiitenimi(l.nimi)"
                                 ui-validate="{tyhja: 'liiteNimiTyhja($value)' }"/>
                          <a ng-show="sallittu('modify-oma-hakemus')" href="" title="Tallenna liitenimi"
                             ng-click="paivitaLiiteNimi(l.liitenumero,l.nimi)">
                            <span class='glyphicon glyphicon-save'></span></a>
                          <a href="" title="Palaa katselutilaan tallentamatta" ng-click="palaaTallentamattaLiite()">
                            <span class='glyphicon glyphicon-eye-open'></span></a>
                          <a ng-show="sallittu('modify-oma-hakemus')" href="" title="Poista liite"
                             ng-click="poistaLiite(l.liitenumero)"><span
                            class='glyphicon glyphicon-remove-sign'></span></a>
                        </p>

                        <p
                          ng-show="hakemusForm.liitenimi.$error.tyhja && !hakemusForm.liitenimi.$pristine"
                          class="help-block">Liitenimi ei saa olla tyhjä.</p>
                      </div>
                    </div>
                    <div
                      ng-hide="(hakemus.hakemustilatunnus == 'K' || hakemus.hakemustilatunnus == 'T0') && sallittu('modify-oma-hakemus')">
                      <p>
                        <a href="api/hakemus/{{hakemusid}}/liite/{{l.liitenumero}}"><span
                          class="glyphicon glyphicon-file"></span>{{l.nimi}}
                          ({{l.contenttype}})</a>
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              <div
                ng-show="(hakemus.hakemustilatunnus == 'K' || hakemus.hakemustilatunnus == 'T0') && sallittu('modify-oma-hakemus')">
                <div class="col-md-4 text-center">
                  <div ng-file-drop ng-model="myFiles" class="drop-box"
                       drag-over-class="{accept:'dragover', reject:'dragover-err', delay:100}"
                       ng-multiple="true" allow-dir="false">
                    <p>Raahaa liite tähän</p>

                    <p>tai</p>

                    <div ng-no-file-drop>Tiedoston raahaaminen ei ole mahdollista tällä selain-versiolla</div>
                    <button ng-file-select class="btn btn-primary" ng-model="myFiles" ng-multiple="true">Valitse
                      tiedosto
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <a href="#/h/hakemukset"><span class='glyphicon glyphicon-circle-arrow-left'></span>Palaa hakemusten
            päänäkymään</a>
        </div>
        <div class="col-md-3">
          <div
            ng-show="(hakemus.hakemustilatunnus == 'K' || hakemus.hakemustilatunnus == 'T0') && sallittu('modify-oma-hakemus')">
            <button data-ng-click="tallennaHakemus()" class="pull-right btn btn-primary">Tallenna tiedot
            </button>
          </div>
          <div
            ng-hide="(hakemus.hakemustilatunnus == 'K' || hakemus.hakemustilatunnus == 'T0') && sallittu('modify-oma-hakemus')">
            <button data-ng-click="tallennaHakemus()" class="pull-right btn btn-primary" disabled>Tallenna
              tiedot
            </button>
          </div>
        </div>
        <div class="col-md-3">
          <div
            ng-show="(hakemus.hakemustilatunnus == 'K' || hakemus.hakemustilatunnus == 'T0') && sallittu('modify-oma-hakemus')">
            <button data-ng-click="naytaHakemus(hakemus.hakemustilatunnus)" class="pull-right btn btn-primary" noenter>
              Tallenna ja esikatsele hakemus
            </button>
          </div>
          <div
            ng-hide="(hakemus.hakemustilatunnus == 'K' || hakemus.hakemustilatunnus == 'T0') && sallittu('modify-oma-hakemus')">
            <button data-ng-click="naytaHakemus(hakemus.hakemustilatunnus)" class="pull-right btn btn-primary" noenter>
              Esikatsele hakemus
            </button>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <h3>HAKEMUKSEN PÄIVÄMÄÄRÄ JA ALLEKIRJOITTAJA</h3>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <h4>Oikeudet hakemuksen lähettämiseen on käyttäjillä, joka toimivat organisaatiossa hakemuksen hyväksyjinä
            ja
            allekirjoittajina.</h4>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <h5>Päivämäärä</h5>

          <p>{{aikaleima | date:'dd.MM.yyyy'}}</p>
        </div>
        <div class="col-md-6">
          <h5>Allekirjoittaja</h5>

          <p>_kirjautuneen allekirjoittajan nimi_</p>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div ng-show="sallittu('allekirjoita-oma-hakemus')">
            <button ng-show="hakemus.hakemustilatunnus == 'K'" data-ng-click="lahetaHakemus()"
                    class="pull-right btn btn-success">Tallenna ja lähetä hakemus
            </button>
            <button ng-show="hakemus.hakemustilatunnus == 'T0'" data-ng-click="lahetaTaydennys()"
                    class="pull-right btn btn-success">Tallenna ja lähetä täydennetty hakemus
            </button>
            <button ng-show="hakemus.hakemustilatunnus != 'K' && hakemus.hakemustilatunnus != 'T0'"
                    data-ng-click="lahetaHakemus()"
                    class="pull-right btn btn-success" disabled>Tallenna ja lähetä hakemus
            </button>
          </div>
          <div ng-hide="sallittu('allekirjoita-oma-hakemus')">
            <button ng-show="hakemus.hakemustilatunnus != 'T0'" data-ng-click="lahetaHakemus()"
                    class="pull-right btn btn-success" disabled>Tallenna ja lähetä hakemus
            </button>
            <button ng-show="hakemus.hakemustilatunnus == 'T0'" data-ng-click="lahetaTaydennys()"
                    class="pull-right btn btn-success">Tallenna ja lähetä täydennetty hakemus
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
